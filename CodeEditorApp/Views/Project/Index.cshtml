@model CodeEditorApp.Models.ViewModels.ProjectViewModel

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/UserHome/_Layout.cshtml";
}
<head>

</head>
<script src="https://use.fontawesome.com/3e0cecfe87.js"></script>
<body>
    <!--Project body starts-->
    <div class="row project-body">
        <!--Project folders and file tree starts-->
        <div class="col-md-2 document-list padding-for-container">
            <p>listi í projectum kemur hér</p>

        </div>
        <!--Project folders and file tree ends-->
        <!--File editor starts-->
        <div class="col-md-9 project-editor ">
         <!--ViewBag for storing the project code-->
            <div id="editor">
                @ViewBag.Code
            </div>
            <div id="color"><input type="button" value="Change Color" onclick="ToggleColor()" class="btn btn-btndefault" /></div>
            <div id="syntax">
                <select>
                    <option value="C">Csharp</option>
                    <option value="Html">Html</option>
                    <option value="JavaScript">JavaScript</option>
                    <option value="TooDoo">TBD</option>
                </select>
            </div>

         
            @section scripts
 {
                <script src="~/3rdparty/src/ace.js" type="text/javascript" charset="utf-8"></script>
                <script src="~/Scripts/jquery.signalR-2.2.1.js"></script>
                <script src="~/signalr/hubs"></script>

                <script>
                //Get the DocumentID from the Controller class
                var documentID = @ViewBag.DocumentID;
                //Start the Ace editor
                var editor = ace.edit("editor");
                editor.setTheme("ace/theme/monokai");
                //Set the Editor in Javascript mode
                editor.getSession().setMode("ace/mode/javascript");
                    function ToggleColor() {
                        if (editor.getTheme() == "ace/theme/monokai") {
                            editor.setTheme("ace/theme/xcode");
                        } else {                       
                            editor.setTheme("ace/theme/monokai");
                        }
                    }
                $("form").submit(function () {
                $("#hidden_editor").val(editor.getSession().getValue());
                });
                var userName = @Html.Raw(Json.Encode(ViewBag.UserName));
                //Start the SignalR Hub
                var myHub1 = $.connection.myHub1;
                //Bool so we don't get stuck in a loop
                var silent = false;
                //What happens every time someone makes changes to a document with more than one user
                myHub1.client.onChange = function (changeData) {
                console.log(changeData);
                silent = true;
                editor.getSession().getDocument().applyDelta(changeData);
                myHub1.server.send($('#displayname').val(), $('#update').val());
                silent = false;
    };
                //What happens after client sends data
                $.connection.hub.start().done(function () {
                myHub1.server.joinDocument(documentID);
                editor.on("change", function (obj) {
                    if(silent){
                    return;
                    }
                //Sends the Object from Ace Editor(Position of change, what changed)
                console.log(obj);
                myHub1.server.onChange(obj, documentID);
        });
    });
                </script>
                <script>
                    $(function () {
                        // Reference the auto-generated proxy for the hub.
                        var chat = $.connection.myHub1;

                        // Create a function that the hub can call back to display messages.
                        chat.client.addNewMessageToPage = function (name, message) {
                            // Add the message to the page.
                            $('#discussion').replaceWith('<li><strong>' + htmlEncode(name)
                                + '</strong>: ' + htmlEncode(message) +  '</li>');
                        };
                        //Set the name of the user
                        $('#displayname').val(userName);
                        //Set the message that displays on update
                        $('#update').val('Made the last change');
                        // Set initial focus to message input box.
                        //$('#message').focus();
                        // Start the connection.
                        $.connection.hub.start().done(function () {
                            $('#sendmessage').click(function () {
                                // Call the Send method on the hub.
                                myHub1.server.send($('#displayname').val(), $('#message').val());
                                // Clear text box and reset focus for next comment.
                                $('#message').val('').focus();
                            });
                        });
                    });
                    // This optional function html-encodes messages for display in the page.
                    function htmlEncode(value) {
                        var encodedValue = $('<div />').text(value).html();
                        return encodedValue;
                    }
                </script>
}

            <div class="project-update">
                @*<p class="l-text-user">Updates</p>*@
                <input class="hover-user" type="hidden" id="displayname" />
                <input class="hover-user" type="hidden" id="update" />
                <ul class="hover-user" id="discussion"></ul>
            </div>
        </div>
        <!--File editor ends-->
        <!--Pop-out nav start-->
            <div id="project-chat" class="sidenav padding-for-container">
                <h3>chat</h3>
                <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
            </div>
            <div id="project-members" class="sidenav padding-for-container">
                <h3>members</h3>
                <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam.</p>
            </div>
            <div id="project-goals" class="sidenav padding-for-container">
                <h3>todo</h3>
                <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
            </div>
        <!--Pop-out nav ends -->
        <!--Action nav starts -->
        <div class="col-md-1 project-actions">
            <ul>
                <li><span onclick="closeAllNavs()" class="clickable-icon"><i class="fa fa-code fa-3x" aria-hidden="true"></i></span></li>
                <li><span onclick="openNav('project-chat');" class="clickable-icon"><i class="glyphicon glyphicon-comment fa-3x" aria-hidden="true"></i></span></li>
                <li><span onclick="openNav('project-members');" class="clickable-icon"><i class="fa fa-users fa-3x" aria-hidden="true"></i></span></li>
                <li><span onclick="openNav('project-goals')" class="clickable-icon"><i class="fa fa-check-square-o fa-3x" aria-hidden="true"></i></span></li>
            </ul>
        </div>
        <!--Action nav ends -->
    </div>
    <!--Project body ends-->
    <script>
/*þarf að færa*/
        function openNav(name) {
            document.getElementById(name).style.width = "300px";/* Set the width of the side navigation to 250px */
            if (name != "project-chat")
            {
                closeNav("project-chat");
            }
            if (name != "project-members")
            {
                closeNav("project-members");
            }
            if (name != "project-goals")
            {
                closeNav("project-goals");
            }
        }

        /* Set the width of the side navigation to 0 */
        function closeNav(name) {
            document.getElementById(name).style.width = "0";
        }

        function closeAllNavs()
        {
            closeNav("project-chat");
            closeNav("project-members");
            closeNav("project-goals");
        }
    </script>

   
   
</body>